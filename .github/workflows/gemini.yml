name: Run Gemini CLI

on:
  workflow_dispatch:  # Manually trigger from Actions tab

jobs:
  run-gemini:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Gemini CLI
        id: gemini
        uses: google-github-actions/run-gemini-cli@v0.1.14
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_debug: true
          prompt: "We'd like you to register tools for airtable discover the github issues on there, find the slack message and reply to the thread with hello. in that order thanks xoxo"
          settings: |
            {
              "mcpServers": {
                "cospec": {
                  "httpUrl": "https://sit.cospec.ai/mcp?deploymentId=50b9cf59-4b55-4516-a6e1-9077a6070640",
                  "headers": {
                    "x-auth-header": "${{ secrets.COSPEC_API_TOKEN }}",
                    "Content-Type": "application/json"
                  },
                  "timeout": 5000
                }
              }
            }

      - name: Display Gemini Response
        if: always()
        run: |
          echo "### Gemini Response" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.gemini.outputs.summary }}" >> $GITHUB_STEP_SUMMARY

      - name: Display Errors
        if: failure()
        run: |
          echo "### Errors" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.gemini.outputs.error }}" >> $GITHUB_STEP_SUMMARY
